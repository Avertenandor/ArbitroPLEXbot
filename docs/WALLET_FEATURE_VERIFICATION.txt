# üîç –ü–†–û–í–ï–†–ö–ê: Wallet Balance Checking –¥–ª—è ARIA

## –¶–µ–ª—å –ø—Ä–æ–≤–µ—Ä–∫–∏
–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–æ–≤—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª **—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è** —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ ARIA –º–æ–∂–µ—Ç:
1. –ü—Ä–æ–≤–µ—Ä—è—Ç—å –±–∞–ª–∞–Ω—Å—ã BNB/USDT/PLEX —á–µ—Ä–µ–∑ NodeReal RPC
2. –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å PLEX
3. –í –∫–æ–Ω—Ü–µ –¥–∏–∞–ª–æ–≥–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞—Ç—å –¥–æ–∫—É–ø–∏—Ç—å PLEX –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

---

## üìã –ö–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:
- `app/services/ai_wallet_service.py` ‚Äî –Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å (310 —Å—Ç—Ä–æ–∫)

### –ò–∑–º–µ–Ω—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
- `app/services/ai_assistant_service.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã tools –∏ –º–µ—Ç–æ–¥—ã
- `bot/handlers/menu/user_ai_assistant.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å wallet tools

---

## üéØ –ó–ê–î–ê–ù–ò–Ø –î–õ–Ø 20 –ê–ì–ï–ù–¢–û–í

### üîπ –ê–ì–ï–ù–¢ 1: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ AIWalletService

**–§–∞–π–ª:** `app/services/ai_wallet_service.py`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
# –ö–ª–∞—Å—Å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
class AIWalletService:
    def __init__(self, session, admin_data=None)
    async def check_user_wallet(self, user_identifier) -> dict
    async def get_plex_rate(self) -> dict
    async def get_wallet_summary_for_dialog_end(self, user_telegram_id) -> dict
    def _format_balance_message(...) -> str
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –í—Å–µ –ª–∏ –º–µ—Ç–æ–¥—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã?
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏?
3. –ï—Å—Ç—å –ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫?

---

### üîπ –ê–ì–ï–ù–¢ 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WalletInfoService

**–§–∞–π–ª:** `app/services/ai_wallet_service.py` —Å—Ç—Ä–æ–∫–∏ 55-110

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
# –î–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π —Å–µ—Ä–≤–∏—Å:
from app.services.wallet_info_service import WalletInfoService

# –ò –≤—ã–∑—ã–≤–∞—Ç—å:
balance = await self.wallet_service.get_wallet_balances(wallet_address)
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è WalletInfoService?
2. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è None —Ä–µ–∑—É–ª—å—Ç–∞—Ç?
3. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ asyncio –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤?

---

### üîπ –ê–ì–ï–ù–¢ 3: –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É

**–§–∞–π–ª:** `app/services/ai_wallet_service.py` —Å—Ç—Ä–æ–∫–∏ 60-100

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏–∫—É –ø–æ–∏—Å–∫–∞:**
```python
# –î–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:
# 1. Wallet address (0x...)
# 2. @username
# 3. telegram_id (—á–∏—Å–ª–æ–≤–æ–π)
# 4. username –±–µ–∑ @
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –í—Å–µ –ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã?
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UserRepository?
3. –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω?

---

### üîπ –ê–ì–ï–ù–¢ 4: –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ check_user_wallet

**–§–∞–π–ª:** `app/services/ai_wallet_service.py` —Å—Ç—Ä–æ–∫–∏ 150-195

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –æ—Ç–≤–µ—Ç–∞:**
```python
return {
    "success": True,
    "wallet": {"address": ..., "address_short": ...},
    "balances": {
        "bnb": {"raw": float, "formatted": str},
        "usdt": {"raw": float, "formatted": str},
        "plex": {"raw": float, "formatted": str},
    },
    "plex_rate": {"per_dollar": int, "description": str, "example": str},
    "recommendations": [...],
    "warnings": [...],
    "user": {...} | None,
    "checked_at": str,
    "message": str,
}
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –í—Å–µ –ª–∏ –ø–æ–ª—è –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç?
2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö?
3. –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ human-readable?

---

### üîπ –ê–ì–ï–ù–¢ 5: –õ–æ–≥–∏–∫–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

**–§–∞–π–ª:** `app/services/ai_wallet_service.py` —Å—Ç—Ä–æ–∫–∏ 125-145

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –ª–æ–≥–∏–∫—É:**
```python
RECOMMENDED_PLEX_MIN = 1000
RECOMMENDED_BNB_MIN = Decimal("0.005")

# –õ–æ–≥–∏–∫–∞:
if plex_balance < RECOMMENDED_PLEX_MIN:
    recommendations.append("üíé –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–∫—É–ø–∏—Ç—å...")

if bnb_balance < RECOMMENDED_BNB_MIN:
    warnings.append("‚ö†Ô∏è –ú–∞–ª–æ BNB –¥–ª—è –∫–æ–º–∏—Å—Å–∏–π!")
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ê–¥–µ–∫–≤–∞—Ç–Ω—ã –ª–∏ –ø–æ—Ä–æ–≥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è?
2. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è?
3. –ï—Å—Ç—å –ª–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ —Ä—É—Å—Å–∫–∏–π?

---

### üîπ –ê–ì–ï–ù–¢ 6: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫—É—Ä—Å–∞ PLEX

**–§–∞–π–ª:** `app/services/ai_wallet_service.py` —Å—Ç—Ä–æ–∫–∏ 200-250

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
async def get_plex_rate(self) -> dict:
    # –î–æ–ª–∂–µ–Ω –ø–æ–ª—É—á–∞—Ç—å –∏–∑ DepositLevelConfigRepository
    # –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç PLEX_PER_DOLLAR_DAILY = 10
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –û—Ç–∫—É–¥–∞ –±–µ—Ä—ë—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π –∫—É—Ä—Å?
2. –ï—Å—Ç—å –ª–∏ fallback –Ω–∞ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?
3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏–º–µ—Ä—ã (daily/weekly/monthly)?

---

### üîπ –ê–ì–ï–ù–¢ 7: –°–≤–æ–¥–∫–∞ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞

**–§–∞–π–ª:** `app/services/ai_wallet_service.py` —Å—Ç—Ä–æ–∫–∏ 255-300

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
async def get_wallet_summary_for_dialog_end(self, user_telegram_id):
    # –î–æ–ª–∂–µ–Ω:
    # 1. –í—ã–∑–≤–∞—Ç—å check_user_wallet
    # 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å plex_status (‚úÖ/üëç/‚ö†Ô∏è/‚ùå)
    # 3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å should_buy_more
    # 4. –°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å end_dialog_message
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ –ø–æ—Ä–æ–≥–∏ –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ PLEX?
2. –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ª–∏ –≤–æ–ø—Ä–æ—Å –æ –¥–æ–∫—É–ø–∫–µ?
3. –í–∫–ª—é—á–∞—é—Ç—Å—è –ª–∏ warnings?

---

### üîπ –ê–ì–ï–ù–¢ 8: Admin Tools Definition

**–§–∞–π–ª:** `app/services/ai_assistant_service.py`

**–ù–∞–π—Ç–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è tools:**
```python
# –ü–æ–∏—Å–∫: "WALLET BALANCE TOOLS"
{
    "name": "check_user_wallet",
    "description": "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã –∫–æ—à–µ–ª—å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è...",
    "input_schema": {"properties": {"user_identifier": ...}}
},
{
    "name": "get_plex_rate",
    ...
},
{
    "name": "get_wallet_summary_for_dialog",
    ...
}
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –í—Å–µ –ª–∏ 3 admin tools –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã?
2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ª–∏ input_schema?
3. –ü–æ–Ω—è—Ç–Ω—ã–µ –ª–∏ descriptions?

---

### üîπ –ê–ì–ï–ù–¢ 9: Admin Tools Execution

**–§–∞–π–ª:** `app/services/ai_assistant_service.py`

**–ù–∞–π—Ç–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É tools:**
```python
# –ü–æ–∏—Å–∫: "WALLET BALANCE TOOLS" –≤ _execute_tools
elif tool_name in ("check_user_wallet", "get_plex_rate", "get_wallet_summary_for_dialog"):
    from app.services.ai_wallet_service import AIWalletService
    wallet_service = AIWalletService(session, admin_data)
    
    if tool_name == "check_user_wallet":
        result = await wallet_service.check_user_wallet(...)
    elif tool_name == "get_plex_rate":
        result = await wallet_service.get_plex_rate()
    elif tool_name == "get_wallet_summary_for_dialog":
        result = await wallet_service.get_wallet_summary_for_dialog_end(...)
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è AIWalletService?
2. –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –ª–∏ –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã?
3. –ï—Å—Ç—å –ª–∏ try/except?

---

### üîπ –ê–ì–ï–ù–¢ 10: User Tools Definition

**–§–∞–π–ª:** `app/services/ai_assistant_service.py`

**–ù–∞–π—Ç–∏ –º–µ—Ç–æ–¥:**
```python
def _get_user_wallet_tools(self) -> list[dict]:
    return [
        {"name": "check_my_wallet", ...},
        {"name": "get_current_plex_rate", ...},
    ]
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ª–∏ –æ–±–∞ user tools?
2. –û—Ç–ª–∏—á–∞—é—Ç—Å—è –ª–∏ –Ω–∞–∑–≤–∞–Ω–∏—è –æ—Ç admin tools (check_my_wallet vs check_user_wallet)?
3. –ù–µ—Ç –ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –∫–æ—à–µ–ª—ë–∫)?

---

### üîπ –ê–ì–ï–ù–¢ 11: User Chat Method

**–§–∞–π–ª:** `app/services/ai_assistant_service.py`

**–ù–∞–π—Ç–∏ –º–µ—Ç–æ–¥:**
```python
async def chat_user_with_wallet(
    self,
    message: str,
    user_telegram_id: int,
    user_data: dict | None = None,
    conversation_history: list[dict] | None = None,
    session: Any = None,
) -> str:
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ú–µ—Ç–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?
2. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏ user_telegram_id?
3. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ª–∏ session –¥–ª—è wallet lookups?
4. –í—ã–∑—ã–≤–∞–µ—Ç –ª–∏ _get_user_wallet_tools()?

---

### üîπ –ê–ì–ï–ù–¢ 12: User Tools Execution

**–§–∞–π–ª:** `app/services/ai_assistant_service.py`

**–ù–∞–π—Ç–∏ –º–µ—Ç–æ–¥:**
```python
async def _execute_user_wallet_tools(
    self,
    content: list,
    user_telegram_id: int,
    session: Any,
) -> list[dict]:
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ü—Ä–∞–≤–∏–ª—å–Ω–æ –ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è check_my_wallet?
2. –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ user_telegram_id –∫–∞–∫ user_identifier?
3. –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ª–∏ tool_results –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ?

---

### üîπ –ê–ì–ï–ù–¢ 13: SYSTEM_PROMPT_USER Updates

**–§–∞–π–ª:** `app/services/ai_assistant_service.py`

**–ù–∞–π—Ç–∏ –≤ SYSTEM_PROMPT_USER:**
```python
=== –ü–†–û–í–ï–†–ö–ê –ö–û–®–ï–õ–¨–ö–ê –ò PLEX ===
–í –ö–û–ù–¶–ï –ö–ê–ñ–î–û–ì–û –î–ò–ê–õ–û–ì–ê —Ç—ã –î–û–õ–ñ–ù–ê:
1. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å tool `get_wallet_summary_for_dialog` —Å telegram_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –µ–≥–æ –±–∞–ª–∞–Ω—Å—ã: BNB, USDT, PLEX
3. –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π –∫—É—Ä—Å PLEX (—Å–∫–æ–ª—å–∫–æ PLEX –∑–∞ $1 –¥–µ–ø–æ–∑–∏—Ç–∞ –≤ —Å—É—Ç–∫–∏)
4. –ï—Å–ª–∏ PLEX < 1000 ‚Äî –º—è–≥–∫–æ —Å–ø—Ä–æ—Å–∏—Ç—å...
5. –ï—Å–ª–∏ BNB < 0.005 ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç—å –æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–µ –≥–∞–∑–∞
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ SYSTEM_PROMPT_USER?
2. –ï—Å—Ç—å –ª–∏ –ø—Ä–∏–º–µ—Ä –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∏–∞–ª–æ–≥–∞?
3. –£–ø–æ–º–∏–Ω–∞–µ—Ç—Å—è –ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π tool –¥–ª—è –≤—ã–∑–æ–≤–∞?

---

### üîπ –ê–ì–ï–ù–¢ 14: Handler Integration

**–§–∞–π–ª:** `bot/handlers/menu/user_ai_assistant.py`

**–ù–∞–π—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ handle_user_chat:**
```python
# –ë—ã–ª–æ:
response = await ai_service.chat(...)

# –°—Ç–∞–ª–æ:
response = await ai_service.chat_user_with_wallet(
    message=sanitized_message,
    user_telegram_id=message.from_user.id,
    user_data=user_data,
    conversation_history=history,
    session=session,
)
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ò–∑–º–µ–Ω—ë–Ω –ª–∏ –≤—ã–∑–æ–≤ –Ω–∞ chat_user_with_wallet?
2. –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ session?
3. –ü–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ª–∏ user_telegram_id?

---

### üîπ –ê–ì–ï–ù–¢ 15: NodeReal RPC Integration

**–§–∞–π–ª—ã:**
- `app/services/wallet_info_service.py`
- `app/services/blockchain/balance_operations.py`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ø–æ—á–∫—É –≤—ã–∑–æ–≤–æ–≤:**
```
AIWalletService.check_user_wallet()
  ‚Üí WalletInfoService.get_wallet_balances()
    ‚Üí BlockchainService.get_native_balance() (BNB)
    ‚Üí BlockchainService.get_usdt_balance()
    ‚Üí BlockchainService.get_plex_balance()
      ‚Üí NodeReal RPC
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –°—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ WalletInfoService.get_wallet_balances?
2. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –±–∞–ª–∞–Ω—Å–æ–≤?
3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ PLEX contract address?

---

### üîπ –ê–ì–ï–ù–¢ 16: Error Handling

**–§–∞–π–ª:** `app/services/ai_wallet_service.py`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ try/except –±–ª–æ–∫–∏:**
```python
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã:
# - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω
# - –ö–æ—à–µ–ª—ë–∫ –Ω–µ —É–∫–∞–∑–∞–Ω
# - –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–æ–≤
# - –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫—É—Ä—Å–∞
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –í—Å–µ –ª–∏ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç {"success": False, "error": "..."}?
2. –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∏ —á–µ—Ä–µ–∑ logger?
3. –ü–æ–Ω—è—Ç–Ω—ã–µ –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?

---

### üîπ –ê–ì–ï–ù–¢ 17: Type Hints –∏ Decimal

**–§–∞–π–ª:** `app/services/ai_wallet_service.py`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
from decimal import Decimal
from typing import Any

# –í—Å–µ –º–µ—Ç–æ–¥—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å type hints
async def check_user_wallet(self, user_identifier: str | int) -> dict[str, Any]:
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –í—Å–µ –ª–∏ –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç type hints?
2. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ Decimal –¥–ª—è –¥–µ–Ω–µ–∂–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π?
3. –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ª–∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ Decimal ‚Üí float –¥–ª—è JSON?

---

### üîπ –ê–ì–ï–ù–¢ 18: Constants –∏ Config

**–§–∞–π–ª—ã:**
- `app/services/ai_wallet_service.py`
- `bot/utils/constants.py`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
# ai_wallet_service.py
PLEX_PER_DOLLAR_DAILY = 10
PLEX_CONTRACT = "0xdf179b6cadbc61ffd86a3d2e55f6d6e083ade6c1"
RECOMMENDED_PLEX_MIN = 1000
RECOMMENDED_BNB_MIN = Decimal("0.005")

# bot/utils/constants.py
PLEX_PER_DOLLAR_DAILY = 10
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –°–æ–≤–ø–∞–¥–∞—é—Ç –ª–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã?
2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ª–∏ PLEX contract address?
3. –ù–µ—Ç –ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è (–º–æ–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å)?

---

### üîπ –ê–ì–ï–ù–¢ 19: Security Considerations

**–§–∞–π–ª—ã:**
- `app/services/ai_wallet_service.py`
- `bot/handlers/menu/user_ai_assistant.py`

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
```python
# 1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¢–û–õ–¨–ö–û –°–í–û–ô –∫–æ—à–µ–ª—ë–∫
# –í user tools: check_my_wallet –ù–ï –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
# user_telegram_id –±–µ—Ä—ë—Ç—Å—è –∏–∑ message.from_user.id

# 2. –ê–¥–º–∏–Ω—ã –º–æ–≥—É—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –õ–Æ–ë–û–ô –∫–æ—à–µ–ª—ë–∫
# –í admin tools: check_user_wallet –ø—Ä–∏–Ω–∏–º–∞–µ—Ç user_identifier
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ù–µ–ª—å–∑—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—É–∂–æ–π –∫–æ—à–µ–ª—ë–∫?
2. –ü—Ä–æ—Ö–æ–¥–∏—Ç –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ security checks?
3. –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –ª–∏ –∑–∞–ø—Ä–æ—Å—ã –∫ –∫–æ—à–µ–ª—å–∫–∞–º?

---

### üîπ –ê–ì–ï–ù–¢ 20: End-to-End Flow

**–°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª–Ω—ã–π flow:**

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "ü§ñ –ü–æ–º–æ—â–Ω–∏–∫"
2. –í—ã–±–∏—Ä–∞–µ—Ç "üí¨ –ó–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å"
3. –ü–∏—à–µ—Ç –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å
4. ARIA –æ—Ç–≤–µ—á–∞–µ—Ç
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç "—Å–ø–∞—Å–∏–±–æ" –∏–ª–∏ "–ø–æ–∫–∞"
6. ARIA –¥–æ–ª–∂–Ω–∞:
   a) –í—ã–∑–≤–∞—Ç—å check_my_wallet
   b) –ü–æ–ª—É—á–∏—Ç—å –±–∞–ª–∞–Ω—Å—ã —á–µ—Ä–µ–∑ NodeReal
   c) –ü–æ–∫–∞–∑–∞—Ç—å BNB/USDT/PLEX
   d) –ü–æ–∫–∞–∑–∞—Ç—å –∫—É—Ä—Å PLEX
   e) –ï—Å–ª–∏ PLEX < 1000 ‚Äî –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥–æ–∫—É–ø–∏—Ç—å
```

**–í–æ–ø—Ä–æ—Å—ã:**
1. –ö–∞–∫ ARIA –ø–æ–Ω–∏–º–∞–µ—Ç —á—Ç–æ –¥–∏–∞–ª–æ–≥ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è?
2. –í—ã–∑—ã–≤–∞–µ—Ç –ª–∏ ARIA tools –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏?
3. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –¥–æ–∫—É–ø–∫–∏?

---

## üìä –§–æ—Ä–º–∞—Ç –æ—Ç—á—ë—Ç–∞ –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞

```markdown
## –ê–≥–µ–Ω—Ç N: [–ù–∞–∑–≤–∞–Ω–∏–µ]

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- –ü—É–Ω–∫—Ç 1
- –ü—É–Ω–∫—Ç 2

### ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- –ü—Ä–æ–±–ª–µ–º–∞ 1: –æ–ø–∏—Å–∞–Ω–∏–µ

### ‚ùå –ë–∞–≥–∏/–û—à–∏–±–∫–∏:
- –ë–∞–≥ 1: –æ–ø–∏—Å–∞–Ω–∏–µ, –∫–∞–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è 1
```

---

## üéØ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞

1. **AIWalletService** –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
2. **3 admin tools** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è
3. **2 user tools** –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è  
4. **SYSTEM_PROMPT_USER** —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
5. **user_ai_assistant.py** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥
6. **NodeReal RPC** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –±–∞–ª–∞–Ω—Å—ã
7. **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏** —Ñ–æ—Ä–º–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –Ω–∏–∑–∫–æ–º PLEX
8. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–π –∫–æ—à–µ–ª—ë–∫

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏:
app/services/ai_wallet_service.py              # –ù–û–í–´–ô - –≥–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å
app/services/ai_assistant_service.py           # Tools + prompts + methods
bot/handlers/menu/user_ai_assistant.py         # Handler integration

# –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
app/services/wallet_info_service.py            # –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–æ–≤
app/services/blockchain/balance_operations.py  # RPC –≤—ã–∑–æ–≤—ã
app/repositories/user_repository.py            # –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
app/repositories/deposit_level_config_repository.py  # –ö—É—Ä—Å PLEX
```
