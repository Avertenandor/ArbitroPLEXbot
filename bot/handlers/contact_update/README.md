# Contact Update Handler

Обработчик обновления контактной информации пользователя (телефон и email).

## Структура модуля

Модуль разбит на логически связанные компоненты:

### `__init__.py`
Главный модуль, объединяющий все роутеры и обеспечивающий обратную совместимость.
- Экспортирует главный `router`
- Включает роутеры из всех подмодулей
- Реэкспортирует утилиты

### `utils.py` (56 строк)
Вспомогательные функции для работы с контактами:
- `get_user_or_error()` - получение пользователя с обработкой ошибок
- `navigate_to_home()` - навигация в главное меню

### `menu.py` (205 строк)
Обработчики меню выбора типа контакта:
- `start_update_contacts()` - начало обновления контактов
- `back_from_choice()` - возврат из меню выбора
- `home_from_choice()` - переход в главное меню
- `start_phone_update()` - начало обновления телефона
- `start_email_update()` - начало обновления email
- `start_both_update()` - начало обновления обоих контактов

### `phone.py` (167 строк)
Обработчики обновления номера телефона:
- `skip_phone_update()` - пропуск обновления телефона
- `back_from_phone()` - возврат из ввода телефона
- `home_from_phone()` - переход в главное меню
- `process_phone_update()` - обработка обновления телефона

### `email.py` (133 строки)
Обработчики обновления email адреса:
- `skip_email_update()` - пропуск обновления email
- `back_from_email()` - возврат из ввода email
- `home_from_email()` - переход в главное меню
- `process_email_update()` - обработка обновления email

## Использование

Модуль полностью обратно совместим. Все импорты продолжают работать:

```python
from bot.handlers import contact_update

# Использование router
dp.include_router(contact_update.router)

# Использование утилит (если необходимо)
from bot.handlers.contact_update import get_user_or_error, navigate_to_home
```

## FSM States

Модуль использует следующие состояния из `ProfileUpdateStates`:
- `choosing_contact_type` - выбор типа контакта для обновления
- `waiting_for_phone` - ожидание ввода телефона
- `waiting_for_email` - ожидание ввода email

## Валидация

Используются валидаторы из `app.validators.common`:
- `validate_phone()` - валидация номера телефона
- `validate_email()` - валидация email адреса

## Зависимости

### Внутренние
- `bot.keyboards.reply` - клавиатуры
- `bot.states.profile_update` - FSM состояния
- `bot.handlers.menu` - главное меню
- `bot.i18n.loader` - локализация
- `app.repositories.user_repository` - работа с БД
- `app.validators.common` - валидаторы

### Внешние
- `aiogram` - фреймворк для бота
- `sqlalchemy` - ORM для БД

## Функционал

1. **Обновление телефона** - валидация и сохранение номера телефона
2. **Обновление email** - валидация и сохранение email адреса
3. **Обновление обоих** - последовательное обновление телефона и email
4. **Пропуск полей** - возможность пропустить обновление любого поля
5. **Навигация** - возможность вернуться назад или в главное меню

## История изменений

### 2025-12-05 - Рефакторинг
- Разбит монолитный файл (501 строка) на логические модули
- Улучшена организация кода
- Добавлена документация
- Сохранена полная обратная совместимость
