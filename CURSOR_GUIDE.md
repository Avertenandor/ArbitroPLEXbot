# ü§ñ ArbitroPLEXbot - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ Cursor

> **–í–µ—Ä—Å–∏—è:** 1.0  
> **–î–∞—Ç–∞:** 2025-12-03  
> **–°—Ç–∞—Ç—É—Å:** Production Ready

---

## üìã –û –ø—Ä–æ–µ–∫—Ç–µ

**ArbitroPLEXbot** - —ç—Ç–æ Telegram-–±–æ—Ç –¥–ª—è –∫—Ä–∏–ø—Ç–æ-—Ñ–∏–∞—Ç–Ω–æ–π —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã –Ω–∞ –±–∞–∑–µ –º–æ–Ω–µ—Ç—ã PLEX —Å –≤—ã—Å–æ–∫–æ–¥–æ—Ö–æ–¥–Ω—ã–º–∏ —Ç–æ—Ä–≥–æ–≤—ã–º–∏ —Ä–æ–±–æ—Ç–∞–º–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- üîê **Pay-to-Use –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É —á–µ—Ä–µ–∑ –æ–ø–ª–∞—Ç—É 10 PLEX
- üí∞ **–°–∏—Å—Ç–µ–º–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤** - —Ä–∞–±–æ—Ç–∞ —Å USDT –¥–µ–ø–æ–∑–∏—Ç–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üìä **–£—Ä–æ–≤–Ω–∏ –¥–æ—Å—Ç—É–ø–∞** - 5 —É—Ä–æ–≤–Ω–µ–π –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –±–∞–ª–∞–Ω—Å–∞ PLEX
- üë• **–†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –≤–æ–∑–Ω–∞–≥—Ä–∞–∂–¥–µ–Ω–∏–π
- üîó **On-chain –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤ —á–µ—Ä–µ–∑ BSC blockchain
- üë®‚Äçüíº **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
arbitragebot/
‚îú‚îÄ‚îÄ app/                    # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –∏ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ models/             # SQLAlchemy –º–æ–¥–µ–ª–∏ (–ë–î)
‚îÇ   ‚îú‚îÄ‚îÄ repositories/       # –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
‚îÇ   ‚îú‚îÄ‚îÄ services/           # –ë–∏–∑–Ω–µ—Å-—Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îú‚îÄ‚îÄ tasks/              # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îî‚îÄ‚îÄ utils/              # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ bot/                    # Telegram Bot (aiogram 3.x)
‚îÇ   ‚îú‚îÄ‚îÄ handlers/           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/          # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (Reply/Inline)
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/        # Middleware (auth, session, logging)
‚îÇ   ‚îú‚îÄ‚îÄ states/             # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ i18n/               # –ü–µ—Ä–µ–≤–æ–¥—ã (RU/EN)
‚îÇ   ‚îî‚îÄ‚îÄ main.py             # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –±–æ—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ jobs/                   # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á (APScheduler)
‚îÇ   ‚îú‚îÄ‚îÄ tasks/              # –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.py        # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
‚îÇ   ‚îî‚îÄ‚îÄ worker.py           # Worker –¥–ª—è –∑–∞–¥–∞—á
‚îÇ
‚îú‚îÄ‚îÄ alembic/                # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ scripts/                # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
‚îú‚îÄ‚îÄ tests/                  # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ docker-compose.python.yml  # Docker Compose (–ò–°–ü–û–õ–¨–ó–£–ô –≠–¢–û–¢!)
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è |
|-----------|------------|--------|
| **–Ø–∑—ã–∫** | Python | 3.11+ |
| **Bot Framework** | aiogram | 3.x |
| **–ë–î** | PostgreSQL | 15 |
| **–ö—ç—à/FSM** | Redis | 7 |
| **ORM** | SQLAlchemy | 2.x (async) |
| **–ú–∏–≥—Ä–∞—Ü–∏–∏** | Alembic | - |
| **Blockchain** | Web3.py | - |
| **–ó–∞–¥–∞—á–∏** | APScheduler | - |
| **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** | loguru | - |

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt

# –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env

# –ó–∞–ø–æ–ª–Ω–∏—Ç—å .env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ (—Å–º. SERVER_INFO.md)

# –ó–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL –∏ Redis (Docker)
docker compose -f docker-compose.python.yml up -d postgres redis

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
alembic upgrade head

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
python bot/main.py
```

### 2. –î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ: –∑–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
git add .
git commit -m "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"
git push

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ: –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ gcloud
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="cd /opt/arbitragebot && sudo git pull && sudo docker compose -f docker-compose.python.yml up -d --build"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="sudo docker compose -f /opt/arbitragebot/docker-compose.python.yml logs bot --tail=50"
```

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–´–ï –ü–†–ê–í–ò–õ–ê

### üî¥ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

1. **–ù–ò–ö–û–ì–î–ê –Ω–µ –∫–æ–º–º–∏—Ç–∏—Ç—å:**
   - `.env` —Ñ–∞–π–ª—ã
   - `SERVER_INFO.md` (–ª–æ–∫–∞–ª—å–Ω–æ –¢–û–õ–¨–ö–û!)
   - –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏
   - API —Ç–æ–∫–µ–Ω—ã
   - –ü–∞—Ä–æ–ª–∏

2. **–°–µ–∫—Ä–µ—Ç—ã —Ö—Ä–∞–Ω–∏—Ç—å –≤:**
   - `.env` (–ª–æ–∫–∞–ª—å–Ω–æ)
   - Docker secrets (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
   - –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º:**
   ```bash
   # –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ .gitignore –≤–∫–ª—é—á–∞–µ—Ç:
   git check-ignore .env
   git check-ignore SERVER_INFO.md
   ```

### üî¥ DOCKER COMPOSE

**‚ö†Ô∏è –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–π **–¢–û–õ–¨–ö–û** `docker-compose.python.yml`!

```bash
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
docker compose -f docker-compose.python.yml up -d --build

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
docker compose up -d  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Node.js Dockerfile!
```

### üî¥ –ö–û–î–ò–†–û–í–ö–ê

**–í—Å–µ —Å—Ç—Ä–æ–∫–∏ —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π –¢–û–õ–¨–ö–û —á–µ—Ä–µ–∑ i18n —Å–∏—Å—Ç–µ–º—É!**

```python
# ‚ùå –ü–õ–û–•–û - —Ö–∞—Ä–¥–∫–æ–¥ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
await message.answer("–ü—Ä–∏–≤–µ—Ç!")

# ‚úÖ –•–û–†–û–®–û - —á–µ—Ä–µ–∑ i18n
from bot.i18n.translations import _
await message.answer(_('welcome.greeting'))
```

**–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–µ—Ä–µ–≤–æ–¥–æ–≤:**

1. –û—Ç–∫—Ä–æ–π `bot/i18n/translations.py`
2. –î–æ–±–∞–≤—å –∫–ª—é—á –≤ `RU_TRANSLATIONS` –∏ `EN_TRANSLATIONS`
3. –ò—Å–ø–æ–ª—å–∑—É–π `_('section.key', param1=value1)`

### üî¥ –ú–ò–ì–†–ê–¶–ò–ò –ë–î

**–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π - –í–°–ï–ì–î–ê —Å–æ–∑–¥–∞–≤–∞–π –º–∏–≥—Ä–∞—Ü–∏—é!**

```bash
# –°–æ–∑–¥–∞—Ç—å –∞–≤—Ç–æ–º–∏–≥—Ä–∞—Ü–∏—é
alembic revision --autogenerate -m "–æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
cat alembic/versions/XXXX_–Ω–∞–∑–≤–∞–Ω–∏–µ.py

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–∞
alembic upgrade head

# –û—Ç–∫–∞—Ç–∏—Ç—å –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
alembic downgrade -1
```

---

## üìù –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∞

### 1. –¢–∏–ø–∏–∑–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞

```python
# ‚úÖ –•–û–†–û–®–û
async def get_user(user_id: int) -> User | None:
    """Get user by ID."""
    return await user_repo.get_by_id(user_id)

# ‚ùå –ü–õ–û–•–û
async def get_user(user_id):
    return await user_repo.get_by_id(user_id)
```

### 2. –î–æ–∫—Å—Ç—Ä–æ–∫–∏ –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

```python
async def calculate_daily_plex(deposit_amount: Decimal) -> Decimal:
    """
    Calculate daily PLEX requirement for deposit.
    
    Args:
        deposit_amount: Deposit amount in USDT
        
    Returns:
        Required PLEX per day (10 PLEX per 1 USDT)
        
    Raises:
        ValueError: If deposit_amount is negative
    """
    if deposit_amount < 0:
        raise ValueError("Deposit amount must be positive")
    return deposit_amount * Decimal("10")
```

### 3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ loguru

```python
from loguru import logger

# –ò—Å–ø–æ–ª—å–∑—É–π —É—Ä–æ–≤–Ω–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ
logger.debug("–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏")
logger.info("–û–±—ã—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–∞–±–æ—Ç–µ")
logger.warning("–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–±–ª–µ–º–µ")
logger.error("–û—à–∏–±–∫–∞, –Ω–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç")
logger.critical("–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞, —Ç—Ä–µ–±—É–µ—Ç –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞")
```

### 4. PLEX —Ç–æ–∫–µ–Ω - 9 decimals!

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
PLEX_DECIMALS = 9
plex_balance = amount_wei / (10 ** PLEX_DECIMALS)

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
plex_balance = amount_wei / (10 ** 18)  # –≠—Ç–æ –¥–ª—è USDT!
```

---

## üîç –ß–∞—Å—Ç—ã–µ –∑–∞–¥–∞—á–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ö–µ–Ω–¥–ª–µ—Ä–∞

1. –°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é –≤ `bot/handlers/—Ç–≤–æ–π_–º–æ–¥—É–ª—å.py`:

```python
from aiogram import Router, F
from aiogram.types import Message
from bot.i18n.translations import _

router = Router()

@router.message(F.text == "üéØ –ö–Ω–æ–ø–∫–∞")
async def handle_button(message: Message, **data):
    """Handle button press."""
    await message.answer(_('response.text'))
```

2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π router –≤ `bot/handlers/__init__.py`:

```python
from . import —Ç–≤–æ–π_–º–æ–¥—É–ª—å

def register_handlers(dp: Dispatcher) -> None:
    dp.include_router(—Ç–≤–æ–π_–º–æ–¥—É–ª—å.router)
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è

1. –û–ø—Ä–µ–¥–µ–ª–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ `bot/states/—Ç–≤–æ–π_–º–æ–¥—É–ª—å.py`:

```python
from aiogram.fsm.state import State, StatesGroup

class MyStates(StatesGroup):
    waiting_input = State()
    processing = State()
```

2. –ò—Å–ø–æ–ª—å–∑—É–π –≤ —Ö–µ–Ω–¥–ª–µ—Ä–µ:

```python
from aiogram.fsm.context import FSMContext
from bot.states.—Ç–≤–æ–π_–º–æ–¥—É–ª—å import MyStates

@router.message(F.text == "–ù–∞—á–∞—Ç—å")
async def start_process(message: Message, state: FSMContext):
    await state.set_state(MyStates.waiting_input)
    await message.answer("–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:")

@router.message(MyStates.waiting_input)
async def process_input(message: Message, state: FSMContext):
    await state.clear()
    await message.answer("–ì–æ—Ç–æ–≤–æ!")
```

### –†–∞–±–æ—Ç–∞ —Å –ë–î

```python
from sqlalchemy.ext.asyncio import AsyncSession
from app.repositories.user_repository import UserRepository

async def example(session: AsyncSession, user_id: int):
    user_repo = UserRepository(session)
    
    # –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    user = await user_repo.get_by_telegram_id(user_id)
    
    # –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    new_user = await user_repo.create({
        "telegram_id": user_id,
        "username": "example"
    })
    
    # –û–±–Ω–æ–≤–∏—Ç—å
    await user_repo.update(user.id, {"is_active": True})
    
    # –ù–µ –∑–∞–±—ã—Ç—å commit!
    await session.commit()
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ñ–∞–π–ª
pytest tests/test_wallet_verification.py

# –° –ø–æ–∫—Ä—ã—Ç–∏–µ–º
pytest --cov=app --cov=bot tests/

# –¢–æ–ª—å–∫–æ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã
pytest -m "not slow"
```

### –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞

```python
import pytest
from app.services.wallet_verification_service import WalletVerificationService

@pytest.mark.asyncio
async def test_verify_wallet_sufficient_balance(mock_blockchain):
    """Test wallet verification with sufficient PLEX balance."""
    # Arrange
    service = WalletVerificationService(mock_blockchain)
    wallet = "0x123..."
    
    # Act
    result = await service.verify_wallet(wallet)
    
    # Assert
    assert result.is_verified
    assert result.plex_balance >= 5000
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="sudo docker compose -f /opt/arbitragebot/docker-compose.python.yml logs bot --tail=100"

# –°–ª–µ–¥–∏—Ç—å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="sudo docker compose -f /opt/arbitragebot/docker-compose.python.yml logs bot -f"

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
# bot / worker / scheduler / postgres / redis
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ß–µ—Ä–µ–∑ Docker
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="sudo docker exec -it arbitragebot-postgres psql -U bot -d bot"

# –ü—Ä–∏–º–µ—Ä—ã SQL
SELECT COUNT(*) FROM users;
SELECT * FROM users WHERE telegram_id = 1040687384;
SELECT * FROM deposits WHERE user_id = 1 ORDER BY created_at DESC LIMIT 10;
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis

```bash
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="sudo docker exec -it arbitragebot-redis redis-cli"

# –í redis-cli:
KEYS *                    # –í—Å–µ –∫–ª—é—á–∏
GET fsm:1040687384:state  # FSM —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
TTL key_name              # Time to live
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check

–ë–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç HTTP endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
curl http://35.228.48.9:8080/health

# –û—Ç–≤–µ—Ç:
{
  "status": "healthy",
  "uptime": 123.45,
  "bot_id": 8506414714,
  "bot_username": "ArbitroPLEXbot"
}
```

### –ú–µ—Ç—Ä–∏–∫–∏ —Å–∏—Å—Ç–µ–º—ã

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="df -h /"

# –ü–∞–º—è—Ç—å
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="free -h"

# Docker stats
gcloud compute ssh instance-20251107-043512 \
  --zone=europe-north1-a \
  --project=telegram-bot-444304 \
  --command="sudo docker stats --no-stream"
```

---

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### Workflow –¥–ª—è –Ω–æ–≤–æ–π —Ñ–∏—á–∏

1. **–°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
   ```bash
   git checkout -b feature/my-feature
   ```

2. **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞**
   - –ò–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥
   - –î–æ–±–∞–≤–∏—Ç—å/–æ–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã
   - –û–±–Ω–æ–≤–∏—Ç—å i18n –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
   - –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –µ—Å–ª–∏ –Ω—É–∂–Ω–æ

3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ**
   ```bash
   pytest
   python bot/main.py  # –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
   ```

4. **–ö–æ–º–º–∏—Ç**
   ```bash
   git add .
   git commit -m "feat: –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏—á–∏"
   ```

5. **–î–µ–ø–ª–æ–π –Ω–∞ –ø—Ä–æ–¥**
   ```bash
   git push
   # –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–º–∞–Ω–¥—É –¥–µ–ø–ª–æ—è (—Å–º. –≤—ã—à–µ)
   ```

6. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–æ–¥–µ**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ Telegram
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –æ—à–∏–±–∫–∏

---

## üéØ –ß–µ–∫-–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º (—Ç–∏–ø–∏–∑–∞—Ü–∏—è, –¥–æ–∫—Å—Ç—Ä–æ–∫–∏)
- [ ] –ù–µ—Ç —Ö–∞—Ä–¥–∫–æ–¥–∞ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ i18n)
- [ ] –¢–µ—Å—Ç—ã –Ω–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω—ã (–µ—Å–ª–∏ –∏–∑–º–µ–Ω—è–ª–∏—Å—å –º–æ–¥–µ–ª–∏)
- [ ] `.env` –Ω–µ –≤ –∏–Ω–¥–µ–∫—Å–µ Git
- [ ] `SERVER_INFO.md` –Ω–µ –∏–∑–º–µ–Ω—ë–Ω
- [ ] –ù–µ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
- [ ] –õ–æ–≥–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è loguru –ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- [ ] PLEX decimals = 9 (–Ω–µ 18!)

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

| –†–µ—Å—É—Ä—Å | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----------|
| [SERVER_INFO.md](./SERVER_INFO.md) | **–î–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–µ—Ä–∞ (–õ–û–ö–ê–õ–¨–ù–û!)** |
| [aiogram docs](https://docs.aiogram.dev/) | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è aiogram 3.x |
| [SQLAlchemy docs](https://docs.sqlalchemy.org/) | SQLAlchemy 2.0 |
| [Web3.py docs](https://web3py.readthedocs.io/) | Web3.py –¥–ª—è BSC |
| [BSCScan API](https://docs.bscscan.com/) | BSC Explorer API |
| [Loguru docs](https://loguru.readthedocs.io/) | –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è |

---

## üÜò –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### "UNHANDLED MESSAGE" –≤ –ª–æ–≥–∞—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –¥–ª—è –∫–Ω–æ–ø–∫–∏/–∫–æ–º–∞–Ω–¥—ã.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ù–∞–π—Ç–∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –≤ `bot/keyboards/reply.py`
2. –°–æ–∑–¥–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å `@router.message(F.text == "—Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏")`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–æ—É—Ç–µ—Ä –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω

### –ö—Ä–∞–∫–æ–∑—è–±—Ä—ã –≤ —Å–æ–æ–±—â–µ–Ω–∏—è—Ö

**–ü—Ä–∏—á–∏–Ω–∞:** –•–∞—Ä–¥–∫–æ–¥ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤–º–µ—Å—Ç–æ i18n.

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä—ã—Ç—å `bot/i18n/translations.py`
2. –î–æ–±–∞–≤–∏—Ç—å –∫–ª—é—á –ø–µ—Ä–µ–≤–æ–¥–∞
3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_('section.key')` –≤–º–µ—Å—Ç–æ —Ö–∞—Ä–¥–∫–æ–¥–∞

### –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** Alembic –Ω–µ –≤–∏–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π.

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –º–æ–¥–µ–ª—å –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞ –≤ `app/models/__init__.py`
2. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `alembic revision --autogenerate -m "..."`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—Ä—É—á–Ω—É—é
4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å: `alembic upgrade head`

### Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å—Ç–∞—Ä—Ç—É–µ—Ç

**–ü—Ä–∏—á–∏–Ω–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π docker-compose —Ñ–∞–π–ª.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–π docker-compose.python.yml
docker compose -f docker-compose.python.yml up -d --build
```

---

## üéì –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### –ü–æ—á–µ–º—É aiogram 3.x?

- –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π async/await –ø–æ–¥—Ö–æ–¥
- FSM –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- Middleware —Å–∏—Å—Ç–µ–º–∞
- Typed annotations
- –ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ—á–µ–º—É SQLAlchemy 2.x async?

- –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ async/await
- Type hints –¥–ª—è –º–æ–¥–µ–ª–µ–π (Mapped[...])
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å asyncpg

### –ü–æ—á–µ–º—É Redis –¥–ª—è FSM?

- –ë—ã—Å—Ç—Ä—ã–π –¥–æ—Å—Ç—É–ø –∫ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º
- TTL –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞
- –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### –ü–æ—á–µ–º—É Docker Compose?

- –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
- –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏—è
- –ü—Ä–æ—Å—Ç–æ—Ç–∞ –¥–µ–ø–ª–æ—è
- Health checks –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ

---

## üí° –°–æ–≤–µ—Ç—ã –¥–ª—è Cursor AI

### –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –ø—Ä–æ–µ–∫—Ç–æ–º –ø–æ–º–Ω–∏:

1. **–í—Å–µ–≥–¥–∞ —á–∏—Ç–∞–π `SERVER_INFO.md`** –ø–µ—Ä–µ–¥ —Ä–∞–±–æ—Ç–æ–π —Å —Å–µ—Ä–≤–µ—Ä–æ–º
2. **–ò—Å–ø–æ–ª—å–∑—É–π `docker-compose.python.yml`**, –Ω–µ –æ–±—ã—á–Ω—ã–π docker-compose.yml
3. **PLEX —Ç–æ–∫–µ–Ω = 9 decimals**, USDT = 18 decimals
4. **–ö–∏—Ä–∏–ª–ª–∏—Ü–∞ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ i18n** - `bot/i18n/translations.py`
5. **–ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π** - —Å–æ–∑–¥–∞–≤–∞–π –º–∏–≥—Ä–∞—Ü–∏–∏
6. **–°–µ–∫—Ä–µ—Ç—ã –≤ `.env`** - –Ω–∏–∫–æ–≥–¥–∞ –≤ –∫–æ–¥
7. **–î–µ–ø–ª–æ–π** - —á–µ—Ä–µ–∑ `gcloud compute ssh` + `git pull` + `docker compose up --build`

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞:

- **–î–æ–º–µ–Ω:** –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã, DeFi, Telegram –±–æ—Ç—ã
- **Blockchain:** BSC (Binance Smart Chain)
- **–¢–æ–∫–µ–Ω—ã:** PLEX (9 decimals), USDT (18 decimals)
- **–ë–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—å:** Pay-to-Use, —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞, –¥–µ–ø–æ–∑–∏—Ç—ã
- **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏:** –ö—Ä–∏–ø—Ç–æ–∏–Ω–≤–µ—Å—Ç–æ—Ä—ã, —Ç—Ä–µ–π–¥–µ—Ä—ã
- **–ê–¥–º–∏–Ω—ã:** –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ (super_admin, senior_admin, support)

---

**–í–µ—Ä—Å–∏—è:** 1.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-12-03  
**–ê–≤—Ç–æ—Ä:** Claude Sonnet 4.5 (Cursor AI)

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ! üöÄ**

